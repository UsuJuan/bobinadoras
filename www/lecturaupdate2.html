<!doctype html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<title>Ingresar Datos</title>
	<link rel="stylesheet" href="css/bootstrap.css" />
	<link rel="stylesheet" href="css/estilos.css" />
</head>
<body>
	<div class="text-right">
		<a href="index.html" class="icono-menu" >
			MENU <span class="glyphicon glyphicon-align-justify" ></span>
		</a>
	</div>
	<div class="alert alert-success" role="alert">
		<h3>
			SE MODIFICÃ“ CON EXITO.
		</h3>
	</div>
	<form class="form-horizontal my_form" role="form" name="form_lectura_update" action="" method="POST" >
		<input type="hidden" id="tipo_lectura_update"/>
		<div class="form-group">
		   	<div class="text-center">
		   		<label for="maquina_upd" class="control-label label_grande">MAQUINA</label>
		   	</div>
	   		<div class="col-md-4"></div>
			<div class="col-sm-1 col-md-4">
			      <input type="text" class="form-control input_grande" id="maquina_upd" name="maquina_upd" disabled >
			</div>
		</div>
		<div class="form-group">
		   	<div class="text-center">
		   		<label for="unidad_upd" class="control-label label_grande">UNIDAD</label>
		   	</div>
	   		<div class="col-md-4"></div>
			<div class="col-sm-1 col-md-4">
			      <input type="text" class="form-control input_grande" id="unidad_upd" name="unidad_upd" disabled >
			</div>
		</div>
		<div class="form-group">
			<div class="text-center">
		   		<label for="kgs" class="control-label label_grande">KGS</label>
		   	</div>
		   	<div class="col-sm-7 col-xs-7">
		      	<input type="number" class="form-control input_grande" id="kgs_1" name="kgs_1" >
		    </div>
		    <div class="col-sm-1 col-xs-1">
		    	<label class="control-label label_grande">.</label>
		    </div>
		    <div class="col-sm-4 col-xs-4">
		    	<input type="number" class="form-control input_grande twodigits" id="kgs_2" name="kgs_2" >
		    </div>
		</div>
		<div class="row">
			<div class="col-md-4"></div>
	    	<div class="alert alert-danger text-center col-sm-1 col-md-4" id="error-kgs" role="alert">
	      		<h2>COMPLETAR!</h2>
	      	</div>
	    </div>
		<div class="form-group">
			<div class="text-center">
		   		<label for="purgador" class="control-label label_grande">CORTE PURGADOR</label>
		   	</div>
		   	<div class="col-sm-7 col-xs-7">
		      	<input type="number" class="form-control input_grande" id="purgador_1" name="purgador_1" >
		    </div>
		    <div class="col-sm-1 col-xs-1">
		    	<label class="control-label label_grande">.</label>
		    </div>
		    <div class="col-sm-4 col-xs-4">
		    	<input type="number" class="form-control input_grande twodigits" id="purgador_2" name="purgador_2" >
		    </div>
		</div>
		<div class="row">
			<div class="col-md-4"></div>
	    	<div class="alert alert-danger text-center col-sm-1 col-md-4" id="error-purgador" role="alert">
	      		<h2>COMPLETAR!</h2>
	      	</div>
	    </div>
	    <div class="form-group">
			<div class="text-center">
		   		<label for="empalmes" class="control-label label_grande">EMPALMES</label>
		   	</div>
		   	<div class="col-sm-7 col-xs-7">
		      	<input type="number" class="form-control input_grande" id="empalmes_1" name="empalmes_1" >
		    </div>
		    <div class="col-sm-1 col-xs-1">
		    	<label class="control-label label_grande">.</label>
		    </div>
		    <div class="col-sm-4 col-xs-4">
		    	<input type="number" class="form-control input_grande twodigits" id="empalmes_2" name="empalmes_2" >
		    </div>
		</div>
		<div class="row">
			<div class="col-md-4"></div>
	    	<div class="alert alert-danger text-center col-sm-1 col-md-4" id="error-empalmes" role="alert">
	      		<h2>COMPLETAR!</h2>
	      	</div>
	    </div>
		<div class="form-group">
		    <div class="col-xs-offset-1 col-sm-offset-3">
		      <button type="submit" class="btn btn-primary boton">GUARDAR</button>
		      <a href="lecturaupdate.html" class="btn btn-danger boton" >ATRAS</a>
		    </div>
		</div>
	</form>
<script type="text/javascript" src="js/jquery.min.js" ></script>
<script type="text/javascript" src="js/bootstrap.js" ></script>
<script>
	id = localStorage.getItem('id_bob_upd');
	$(function(){
		$(".twodigits").keypress(function(evt){
			if($(this).val().length==2){
		        return false;
		    }
	    });
		$('.alert-danger').css('display','none');
		$('.alert-success').css('display','none');
		if (localStorage.getItem('lis_lec_bob')!=null){
			bob_upd = JSON.parse(localStorage.getItem('lis_lec_bob'));
			for(var i=0;i<bob_upd.length;i++){
				if(bob_upd[i]['id']==id){
					$('#tipo_lectura_update').val(bob_upd[i]['tipo_lectura']);
					$('#maquina_upd').val(bob_upd[i]['maquina']);
					$('#unidad_upd').val(bob_upd[i]['unidad']);
					kilos = bob_upd[i]['kgs'].split(".");
					$('#kgs_1').val(kilos[0]);
					$('#kgs_2').val(kilos[1]);
					purgador = bob_upd[i]['purgador'].split(".");
					$('#purgador_1').val(purgador[0]);
					$('#purgador_2').val(purgador[1]);
					empalmes = bob_upd[i]['empalmes'].split(".");
					$('#empalmes_1').val(empalmes[0]);
					$('#empalmes_2').val(empalmes[1]);
				}
			}
		}

		if (localStorage.getItem('lis_parcial_bob')!=null){
			lp = JSON.parse(localStorage.getItem('lis_parcial_bob'));
			for(var i=0;i<lp.length;i++){
				if(lp[i]['id']==id){
					$('#tipo_lectura_update').val(lp[i]['tipo_lectura']);
					$('#maquina_upd').val(lp[i]['maquina']);
					$('#unidad_upd').val(lp[i]['unidad']);
					kilos_p = lp[i]['kgs'].split(".");
					$('#kgs_1').val(kilos_p[0]);
					$('#kgs_2').val(kilos_p[1]);
					purgador_p = lp[i]['purgador'].split(".");
					$('#purgador_1').val(purgador_p[0]);
					$('#purgador_2').val(purgador_p[1]);
					empalmes_p = lp[i]['empalmes'].split(".");
					$('#empalmes_1').val(empalmes_p[0]);
					$('#empalmes_2').val(empalmes_p[1]);
				}
			}
		}

		$('form[name=form_lectura_update]').on('submit',function(event){
			event.preventDefault();
			if(Valida() == 0 ){
				if($('#tipo_lectura_update').val()!="PARCIAL" && localStorage.getItem('lis_lec_bob')!=null ){
					lis_bob = JSON.parse(localStorage.getItem('lis_lec_bob'));
					for(var i=0;i<lis_bob.length;i++){
						if(lis_bob[i]['id']==id){
							lis_bob[i]['kgs'] = $('#kgs_1').val()+"."+VerVacio('kgs_2');
							lis_bob[i]['purgador'] = $('#purgador_1').val()+"."+VerVacio('purgador_2');
							lis_bob[i]['empalmes'] = $('#empalmes_1').val()+"."+VerVacio('empalmes_2');
							myjson_string = JSON.stringify(lis_bob);
							localStorage.setItem('lis_lec_bob',myjson_string);
							$('.alert-success').show().delay(5000).fadeOut();
							localStorage.removeItem('id_bob_upd');
							break;
						}
					}
				}else{
					lp = JSON.parse(localStorage.getItem('lis_parcial_bob'));
					for(var i=0;i<lp.length;i++){
						if(lp[i]['id']==id){
							lp[i]['kgs'] = $('#kgs_1').val()+"."+VerVacio('kgs_2');
							lp[i]['purgador'] = $('#purgador_1').val()+"."+VerVacio('purgador_2');
							lp[i]['empalmes'] = $('#empalmes_1').val()+"."+VerVacio('empalmes_2');
							myjson_string = JSON.stringify(lp);
							localStorage.setItem('lis_parcial_bob',myjson_string);
							$('.alert-success').show().delay(5000).fadeOut();
							localStorage.removeItem('id_bob_upd');
							break;
						}
					}
				}
			}
		});

		function Valida(){
			var rpta=0;
			if ($('#kgs_1').val()==""){
				rpta = 1;
				$('#error-kgs').show().delay(5000).fadeOut();
			}
			if ($('#purgador_1').val()==""){
				rpta = 1;
				$('#error-purgador').show().delay(5000).fadeOut();
			}
			if ($('#empalmes_1').val()==""){
				rpta = 1;
				$('#error-empalmes').show().delay(5000).fadeOut();
			}
			return rpta;
		}
		function VerVacio(campo){
			valor = $(String('#'+campo)).val();
			if($(String('#'+campo)).val()==""){
				valor = "0";
			}
			return valor;
		}

	})
</script>
</body>
</html>